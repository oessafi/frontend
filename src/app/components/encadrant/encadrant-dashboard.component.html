<div class="container py-4">
  <h2 class="mb-3">Tableau de bord Encadrant</h2>

  <div *ngIf="loading" class="text-center my-4">
    <div class="spinner-border text-primary" role="status"><span class="visually-hidden">Chargement...</span></div>
  </div>
  <div *ngIf="errorMessage" class="alert alert-danger">{{ errorMessage }}</div>
  <div *ngIf="successMessage" class="alert alert-success">{{ successMessage }}</div>

  <ul class="nav nav-tabs mb-3">
    <li class="nav-item">
      <a class="nav-link" [class.active]="activeTab === 'validation'" (click)="setTab('validation')">Inscriptions à valider</a>
    </li>
    <li class="nav-item">
      <a class="nav-link" [class.active]="activeTab === 'doctorants'" (click)="setTab('doctorants')">Mes doctorants</a>
    </li>
  </ul>

  <!-- Onglet validation -->
  <div *ngIf="activeTab === 'validation'">
    <table class="table table-bordered">
      <thead>
        <tr>
          <th>Doctorant</th>
          <th>Sujet</th>
          <th>Statut</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let insc of inscriptionsToValidate">
          <td>{{ insc.doctorantName }}</td>
          <td>{{ insc.sujetThese }}</td>
          <td><span class="badge bg-warning">En attente</span></td>
          <td>
            <button class="btn btn-success btn-sm me-2" (click)="validerDossier(insc.id, true)">Approuver</button>
            <button class="btn btn-danger btn-sm" (click)="validerDossier(insc.id, false)">Rejeter</button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Onglet doctorants -->
  <div *ngIf="activeTab === 'doctorants'">
    <table class="table table-bordered">
      <thead>
        <tr>
          <th>Doctorant</th>
          <th>Sujet</th>
          <th>Statut</th>
          <th>Jury</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let insc of validatedDoctorants">
          <td>{{ insc.doctorantName }}</td>
          <td>{{ insc.sujetThese }}</td>
          <td><span class="badge bg-success">Validée</span></td>
          <td>
            <button class="btn btn-primary btn-sm" (click)="openJuryModal(insc)">Proposer Jury</button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Modale proposition jury -->
  <div class="modal fade show" tabindex="-1" [ngStyle]="{ display: showJuryModal ? 'block' : 'none' }" *ngIf="showJuryModal">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Proposition de Jury</h5>
          <button type="button" class="btn-close" (click)="showJuryModal = false"></button>
        </div>
        <form [formGroup]="juryForm" (ngSubmit)="submitJury()">
          <div class="modal-body">
            <div formArrayName="membres">
              <div *ngFor="let membre of juryForm.get('membres').controls; let i = index" [formGroupName]="i" class="mb-3">
                <input type="text" class="form-control mb-1" formControlName="nom" placeholder="Nom du membre">
                <input type="text" class="form-control" formControlName="role" placeholder="Rôle (ex: Président)">
                <button type="button" class="btn btn-link text-danger" (click)="removeJuryMember(i)" *ngIf="juryForm.get('membres').controls.length > 1">Retirer</button>
              </div>
            </div>
            <button type="button" class="btn btn-secondary" (click)="addJuryMember()">Ajouter un membre</button>
            <div *ngIf="juryError" class="alert alert-danger mt-2">{{ juryError }}</div>
            <div *ngIf="jurySuccess" class="alert alert-success mt-2">{{ jurySuccess }}</div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" (click)="showJuryModal = false">Annuler</button>
            <button type="submit" class="btn btn-primary" [disabled]="juryForm.invalid">Valider</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
